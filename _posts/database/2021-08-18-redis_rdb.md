---
layout: post
title: redis备份-rdb文件使用
category: 数据库
tags: [redis, rdb]
keywords: redis, rdb
---

## 文档
rdb格式: [https://github.com/sripathikrishnan/redis-rdb-tools/wiki/Redis-RDB-Dump-File-Format](https://help.aliyun.com/document_detail/100734.htmlhttps://github.com/sripathikrishnan/redis-rdb-tools/wiki/Redis-RDB-Dump-File-Format)

## 工具
### rdbtools的安装
rdbtools有三个主要的功能
- 分析静态rdb文件并生成csv格式的内存报告
- 将rdb文件转储成为json格式
- 利用diff工具比较两个rdb文件的不同

通过python的pip安装:
```
./pip install rdbtools
./pip install python-lzf
```

### 分析

分析rdb文件当中top100的大key:
```
rdb -c memory dump-6120957-redis-server-ignore-140016731-ignore-1-ignore.rdb -l 100  -f ./dump_memory.csv
```

根据key前缀提取所有批评的key(等同于keys*命令):
```
rdb -c memory dump-6120957-redis-server-ignore-140016731-ignore-1-ignore.rdb -k "abc*" -f ./abc.csv
```

### 表头字段说明

| type | key | size_in_bytes | encoding | num_elements | len_largest_element | expiry | |
|------------|-----------------------------|------------|--------------|-------------------------------------|------------------|------------------| --------|
| key所属db编号 | key的类型例如string list set等 | key名 | key大小(字节数) | 编码方式(hashtable，ziplist，string等) | key中元素的个数 | key中最大元素的长度 | 过期时间 |

